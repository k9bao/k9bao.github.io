---
layout: post
title: ffmpeg常用命令行命令
date: 2019-12-03 10:22:45
description: ffmpeg常用命令行命令
tag: ffmpeg

---

# 1. ffmpeg使用说明

- [1. ffmpeg使用说明](#1-ffmpeg%e4%bd%bf%e7%94%a8%e8%af%b4%e6%98%8e)
  - [1.1. 常用命令解析](#11-%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4%e8%a7%a3%e6%9e%90)
    - [1.1.1. 常用命令](#111-%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4)
    - [1.1.2. 能力集查询](#112-%e8%83%bd%e5%8a%9b%e9%9b%86%e6%9f%a5%e8%af%a2)
    - [1.1.3. 音频相关](#113-%e9%9f%b3%e9%a2%91%e7%9b%b8%e5%85%b3)
    - [1.1.4. 编解码](#114-%e7%bc%96%e8%a7%a3%e7%a0%81)
  - [1.2. 常用方法组合](#12-%e5%b8%b8%e7%94%a8%e6%96%b9%e6%b3%95%e7%bb%84%e5%90%88)
    - [1.2.1. ffprobe](#121-ffprobe)
    - [1.2.2. ffplay](#122-ffplay)
    - [1.2.3. ffmpeg](#123-ffmpeg)
      - [1.2.3.1. 截取一段视频](#1231-%e6%88%aa%e5%8f%96%e4%b8%80%e6%ae%b5%e8%a7%86%e9%a2%91)
      - [1.2.3.2. 指定编码I帧间隔](#1232-%e6%8c%87%e5%ae%9a%e7%bc%96%e7%a0%81i%e5%b8%a7%e9%97%b4%e9%9a%94)
      - [1.2.3.3. 去B帧](#1233-%e5%8e%bbb%e5%b8%a7)
      - [1.2.3.4. 分离视频流](#1234-%e5%88%86%e7%a6%bb%e8%a7%86%e9%a2%91%e6%b5%81)
      - [1.2.3.5. 分离音频流](#1235-%e5%88%86%e7%a6%bb%e9%9f%b3%e9%a2%91%e6%b5%81)
      - [1.2.3.6. 文件格式转换](#1236-%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f%e8%bd%ac%e6%8d%a2)
      - [1.2.3.7. 文件合并](#1237-%e6%96%87%e4%bb%b6%e5%90%88%e5%b9%b6)
  - [1.3. 参考资料](#13-%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99)

## 1.1. 常用命令解析

`usage: ffmpeg [options] [[infile options] -i infile]... {[outfile options] outfile}...`

### 1.1.1. 常用命令

- -i input_file:       指定输入文件,所有-i前边的参数，都讲作用于此文件
- -x 320 -y 240:       指定播放窗口大小
- -ss pos:             跳转到指定的位置(秒)
- -bytes:              按字节跳转
- -t duration:         播放 "duration" 秒音/视频
- -window_title:      指定窗口名称
- -autoexit:           播放完成自动接收
- q, ESC:              退出
- f:                   全屏
- p, SPC:              暂停
- w:                   切换显示模式(视频/音频波形/音频频带)
- s:                   步进到下一帧
- left/right:          快退/快进 10 秒
- down/up:             快退/快进 1 分钟
- page down/page up:   跳转到前一章/下一章(如果没有章节，快退/快进 10 分钟)
- -y:                  表示如果输出文件已存在则覆盖。
- -hide_banner:        禁止打印欢迎语；也就是禁止默认会显示的版权信息、编译选项以及库版本信息等

### 1.1.2. 能力集查询

- -buildconf          show build configuration
- -formats            show available formats 显示有效的格式，（也就是-f后面可以接的参数）
- -muxers             show available muxers
- -demuxers           show available demuxers
- -devices            show available devices
- -codecs             show available codecs 显示 libavcodec 已知的所有编解码器（也就是-vcodec -acodec后面可以接的参数）
- -decoders           show available decoders 显示有效的解码器
- -encoders           show available encoders 显示有效的编码器
- -bsfs               show available bit stream filters 显示有效的比特流过滤器
- -protocols          show available protocols 显示有效的协议
- -filters            show available filters 显示 libavfilter 有效的过滤器（也就是-vf后面可以接的参数）
- -pix_fmts           show available pixel formats 显示有效的像素格式
- -layouts            show standard channel layouts 显示通道名称以及标准通道布局,可用的声道布局
- -sample_fmts        show available audio sample formats 显示有效的采样格式
- -colors             show available color names 显示认可的颜色名称
- -sources device     list sources of the input device
- -sinks device       list sinks of the output device
- -hwaccels           show available HW acceleration methods

### 1.1.3. 音频相关

### 1.1.4. 编解码

- -keyint_min:      编码最小I帧间隔
- -g:               编码GOP间隔
- sc_threshold:    编码GOP之间动态增加I帧个数

## 1.2. 常用方法组合

### 1.2.1. ffprobe

- 查看每一帧的时间戳：`.\ffprobe.exe -show_packets -select_streams v test.ts | grep pts_time`

### 1.2.2. ffplay

- 从指定时间开始播放:ffplay -ss 10 -i test.mp4

### 1.2.3. ffmpeg

-i之前的参数，是对input file设置，-i之后，是对output file的设置

#### 1.2.3.1. 截取一段视频

从第10秒开始，截取30秒视频，注意-ss必须放在-i前边，如果-ss放在-i后边，等价于-t  
`ffmpeg -ss 10 -t 30 -i test.mp4 -vcodec copy -acodec copy out.mp4 -y`

从第10秒开始，截取30秒视频
`ffmpeg -ss 00:00:10 -to 00:00:40 -i test.mp4 -vcodec copy -acodec copy out.mp4 -y`

#### 1.2.3.2. 指定编码I帧间隔

编码为h264+aac，编码最小I帧间隔是50，gop间隔是50，GOP之间动态增加I帧个数为0
`ffmpeg -i test.mkv -acodec libfdk_aac -vcodec libx264 -keyint_min 50 -g 50 -sc_threshold 0 out.mkv`

#### 1.2.3.3. 去B帧

`ffmpeg -i test.mp4 -vcodec libx264 -bf 0 test.h264`
`ffmpeg -i test.mp4 -vcodec libx264 -x264opts "bframes=0" test.h264`
`ffmpeg -i test.mp4 -vcodec libx264 -profile:v baseline -pix_fmt yuv420p -s 640x480 test-640x480.h264`
`ffprobe -v quiet -show_frames -select_streams v test.mp4 | find "pict_type=B"` 查看是否包含B帧

#### 1.2.3.4. 分离视频流

`ffmpeg -i test.mp4 -vcodec copy -an 视频流.avi`
-an表示 audio not 不包含音频

#### 1.2.3.5. 分离音频流

`ffmpeg -i test.mp4 -acodec copy -vn 音频流.mp3`
-vn表示 video not 不包含视频

#### 1.2.3.6. 文件格式转换

- ts文件转mp4文件
`ffmpeg.exe -i binjiangdao.ts -vcodec copy binjiangdao.mp4`

#### 1.2.3.7. 文件合并

先创建一个文本文件filelist.txt，内容入下：
file 'input1.mkv'
file 'input2.mkv'
file 'input3.mkv'
然后：`ffmpeg -f concat -i filelist.txt -c copy output.mkv`

## 1.3. 参考资料
