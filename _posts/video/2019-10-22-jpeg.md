---
layout: post
title: jpeg
date: 2019-10-22 09:33:09
description: jpeg
tag: video

---

- [jpeg介绍](#jpeg介绍)
  - [编码](#编码)
  - [解码](#解码)
  - [其他概念](#其他概念)
    - [色彩空间转换](#色彩空间转换)
    - [降采样/升采样](#降采样升采样)
    - [离散余弦变换DCT](#离散余弦变换dct)
    - [量化](#量化)
    - [zig-zag游程编码](#zig-zag游程编码)
    - [范式Huffman编码](#范式huffman编码)
  - [参考资料](#参考资料)

# jpeg介绍
## 编码
    流程:原图像->色彩空间转换(RGB->YCbCr)->下采样（Downsampling）->分块->离散余弦变换（Discrete cosine transform）->量化（Quantization）->熵编码技术（entropy coding）->JPEG数据
## 解码
    流程:JPEG数据->熵解码技术（entropy coding）->反量化（Quantization）->反离散余弦变换（Discrete cosine transform）->合并->上采样（Upsampling）->色彩空间转换(YCbCr->RGB)->原图像

## 其他概念
### 色彩空间转换
    JPEG使用的是YCrCb颜色模型。YCrCb模型中，Y代表明度，Cr、Cb代表色调，每个点保存8bit的Y值，2x2个点保存一个CrCb值，平均每个点占12bit，而RGB模型的每个点需要3个字节共24bit，未编码就具有50%压缩率，所以YCrCb颜色模型更适合图像压缩。常用的YCrCb模型有YUV422和YUV411两种，使用YUV422有33%压缩率。
### 降采样/升采样

### 离散余弦变换DCT
    离散余弦变换DCT是将一组光强数据转化为频率数据。JPEG将整个图像分成8x8的图像块，然后对YCrCb分量分别做DCT变换，如果原始图像的长宽不是8的倍数需要补成8的倍数，因为Cr、Cb都是2x2记录一次，所以大多数情况下要补成16x16的块。图像块按从左到右、从上到下次序排列。
    把8x8的图像作为两维离散余弦变换DCT的输入，输出为8x8变换系数，这些系数都有明确的物理意义。u代表水平像素号，v代表垂直像素号，当u=0、v=0时，F(0,0)是原64个样值的平均，相当于直流分量；随着u、v值增加，相应系数分别代表逐步增加的水平空间频率分量和垂直空间频率分量的大小。在8x8图像块中，像素值一般变化较平缓，因此具有较低的空间频率。使用二维8x8离散余弦变换可以将图像块的能量集中在极少数几个系数上，其他系数的值与这些系数相比，绝对值要小得多，便于后续压缩处理。
### 量化
    DCT本身并不能进行压缩，64个样值仍然得到64个系数。而且经DCT变换后，比特数增加了，直流分量的最大值是256的64/8倍，范围为0~2047，交流分量范围是-1024~1023。量化，是对经过DCT变换后的频率系数进行量化，使其按比例缩小，并取最接近的整数值，作用是在保证一定质量前提下丢弃图像中对视觉效果影响不大的信息。这一步是图像质量下降的最主要原因。
    JPEG标准中采用线性均匀量化器，对64个DCT系数除以量化步长并四舍五入取整，量化步长由量化表决定。量化表为8x8矩阵，与DCT变换系数一一对应，亮度分量和彩色分量使用不同的量化表。量化表一般由用户规定，JPEG标准给出了参考值，其中的元素为1到255之间的整数，其值为对应DCT系数的量化步长。DCT变换系数除以量化表中对应位置的量化步长并舍入小数部分后，多数变为0，从而达到压缩的目的。
按人眼的生理特性设置的量化表，对低频分量采用较细的量化，对高频分量使用更粗的量化，这会使大多数高频分量的系数变为零。JPEG使用均匀量化器。
### zig-zag游程编码
    量化后的系数要重新编排，目的是为了增加连续的0系数的个数，也就是0的游程长度。
    量化后系数的读取顺序按Z字形排列，这样读出后出现连续0的机会比较多，尤其在最后。如果都是0，在读到最后一个数后只要给出块结束EOB码就可以结束输出，节省了很多码率。读出后，8x8矩阵变成1x64的矢量，频率较低的系数放在矢量的顶部。
### 范式Huffman编码


## 参考资料
1. [jpeg编码学习笔记](https://felixzhang00.github.io/2016/12/24/2016-12-24-jpeg%E7%BC%96%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/)
2. [花一天写了个JPEG解码器，来整理一下JPEG格式的原理](https://zhuanlan.zhihu.com/p/27296876?from_voters_page=true)
3. [JPEG格式图像编解码](http://www.dwenzhao.cn/profession/imgia/jpegcode.html)